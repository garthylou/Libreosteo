{% load i18n %}
<h1 class="page-header">
    <span editable-text="patient.family_name" onaftersave="savePatient()">{$ patient.family_name $}</span>
    <span ng-show="patient.original_name">(<span editable-text="patient.original_name" onaftersave="savePatient()">{$ patient.original_name $}</span>)
    </span>
    <span editable-text="patient.first_name" onaftersave="savePatient()">{$ patient.first_name $}</span>
</h1>

<tabset>

<tab heading="{% trans 'General infos' %}">
    <div class="row">
        <div class="col-md-8">
            <div class="panel panel-info">
                <div class="panel-heading">
                    {% trans 'Patient infos' %}
                </div>
                <div class="panel-body row" style="margin-left: 5px; margin-right: 5px">
                    <div class="row">
                        <div class="col-md-2">
                            {{ patient.birth_date }} :
                        </div>
                        <div class="col-md-6"><span e-class="polyfill-updatable" editable-date="patient.birth_date"
                                                    onaftersave="savePatient()" onshow="updateComponentPolyfill()"
                                >{$ (patient.birth_date | date:"dd/MM/yyyy") || '{% trans 'not documented' %}' $}</span>
                        </div>
                        <div class="col-md-4"><span> ( {$ age |Â format_age $} )</span></div>
                    </div>
                    <hr/>
                    <inlineedit class="row col-md-12" model="patient" property="address_street" on-save="savePatient()"
                            placeholder="{{ patient.address_street }}"></inlineedit>

                    <inlineedit class="row col-md-12" model="patient" property="address_complement" on-save="savePatient()"
                            placeholder="{{ patient.address_complement }}"></inlineedit>


                    <div class="row col-md-12">
                        <inlineedit class="row col-md-5" model="patient" property="address_zipcode" on-save="savePatient()"
                            placeholder="{{ patient.address_zipcode }}" width="66px"></inlineedit>

                        <inlineedit class="row col-md-7" model="patient" property="address_city" on-save="savePatient()"
                            placeholder="{{ patient.address_city }}" width="200px"></inlineedit>
                    </div>
                    <div class="row col-md-12">
                        <inlinetel class="row col-md-6" model="patient" property="phone" on-save="savePatient()"
                            placeholder="{{ patient.phone }}" icon="glyphicon glyphicon-phone-alt"></inlinetel>

                        <inlinetel class="row col-md-6"  model="patient" property="mobile_phone" on-save="savePatient()"
                            placeholder="{{ patient.mobile_phone }}" icon="glyphicon glyphicon-earphone"></inlinetel>

                    </div>
                    <hr/>

                    <div class="row">
                        <div class="col-md-4">
                        <span editable-checkbox="patient.smoker"
                              e-title="{{ patient.smoker }}?"
                              class="inlineedit"
                              onaftersave="savePatient()">{$ patient.smoker && "{{ patient.smoker }}" || "{% trans 'Not smoker' %}" $}</span>
                        </div>
                        <div class="col-md-8">
                            {{ patient.doctor }} : <span editable-select="patient.doctor" onshow="loadDoctors()"
                                                         e-ng-options="d.id as (d.family_name + ' - ' + d.city) for d in doctors|orderBy:'family_name'"
                                                         onaftersave="savePatient()"
                                                         tooltip-html-unsafe="{$ doctor.family_name$} {$doctor.first_name$}<br>{$doctor.phone$} - {$doctor.city$}"
                                                         class="inlineedit"
                                                         tooltip-trigger="mouseenter"
                                >{$ doctor.family_name || "{% trans 'not documented' %}" $} - {$ doctor.city || "{% trans 'not documented' %}" $}</span>
                            <button class="btn btn-default btn-xs fa fa-plus"
                                    title="{% trans 'Add a doctor' %}" ng-click="formAddDoctor()"></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="panel panel-danger">
                <div class="panel-heading">
                    {{ patient.important_info }}
                </div>
                <div class="panel-body row">
                    <inlinetextarea model="patient" property="important_info" on-save="savePatient()"
                            placeholder="{{ patient.important_info }}"
                            row="7" col="20"></inlinetextarea>
                </div>
            </div>
        </div>
    </div>
</tab>

<tab heading="{% trans 'History' %}">
    <div class="row">
        <div class="col-md-6">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    {{ patient.surgical_history }}
                </div>
                <div class="panel-body row" style="margin-left: 5px; margin-right: 5px">
                    <inlinetextarea model="patient" property="surgical_history" on-save="savePatient()"
                            placeholder="{{ patient.surgical_history }}"
                            row="5" col="35"></inlinetextarea>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    {{ patient.medical_history }}
                </div>
                <div class="panel-body row" style="margin-left: 5px; margin-right : 5px">
                    <inlinetextarea model="patient" property="medical_history" on-save="savePatient()"
                            placeholder="{{ patient.medical_history }}"
                            row="5" col="35"></inlinetextarea>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    {{ patient.family_history }}
                </div>
                <div class="panel-body row" style="margin-left: 5px; margin-right: 5px">
                    <inlinetextarea model="patient" property="family_history" on-save="savePatient()"
                            placeholder="{{ patient.family_history }}"
                            row="5" col="35"></inlinetextarea>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    {{ patient.trauma_history }}
                </div>
                <div class="panel-body row" style="margin-left: 5px; margin-right : 5px">
                    <inlinetextarea model="patient" property="trauma_history" on-save="savePatient()"
                            placeholder="{{ patient.trauma_history }}"
                            row="5" col="35"></inlinetextarea>
                </div>
            </div>
        </div>
    </div>
</tab>

<tab heading="{% trans 'Medical reports' %}">
    <div class="panel panel-primary">
                <div class="panel-heading">
                    {{ patient.medical_reports }}
                </div>
                <div class="panel-body row" style="margin-left: 5px; margin-right: 5px">
                    <inlinetextarea model="patient" property="medical_reports" on-save="savePatient()"
                            placeholder="{{ patient.medical_reports }}"
                            row="7" col="75"></inlinetextarea>
                </div>
            </div>
</tab>

<tab heading="{% trans 'Examinations' %}" active="$parent.examinationsListActive" ui-sref="patient.examinations">
    <examination model="previousExamination.data" ng-if="previousExamination.data != null" ng-animate="displayExamination"
    save-model="saveExamination(previousExamination.data)"
    new-examination="false"
    close="invoiceExamination(previousExamination.data)"/>
    <timeline archive-examination="previousExamination" examinations="examinations" start-examination="startExamination()" examination-is-active="newExaminationDisplay" ng-if="previousExamination.data == null"
    current-examination="newExamination"
    current-examination-manager="currentExaminationManager()"/>
</tab>

<tab heading="{% trans 'New Examination' %}" ng-show="newExaminationDisplay" active="$parent.newExaminationActive">
    <examination model="newExamination" save-model="saveExamination(newExamination)" close="invoiceExamination(newExamination)" new-examination="true"/>
</tab>
</tabset>
